---
- name: " AWS | SUBNET Create {{ item_subnet.name }}"
  ec2_vpc_subnet:
    state: present
    vpc_id: "{{ vpc_id }}"
    cidr: "{{ item_subnet.cidr }}"
    az: "{{ item_subnet.az }}"
    resource_tags:
      Name: "{{ item_subnet.name }}"
  register: ret_subnet

- name: AWS | SUBNET enable auto assign public IP
  ec2_vpc_subnet_auto_assign_public_ip:
    region: "{{ item_vpc.region }}"
    subnet: "{{ ret_subnet.subnet.id }}"
    state: present
  when: 
    - item_subnet.public_ip is defined 
    - item_subnet.public_ip
  ignore_errors: "{{ ansible_check_mode }}"

- name: AWS | SUBNET | make public lists
  set_fact:
    subnets_pub: "{{ subnets_pub + [ret_subnet.subnet.id] }}"
  when: item_subnet.route == 'rt_public'
  ignore_errors: "{{ ansible_check_mode }}"

- name: AWS | SUBNET | make private lists
  set_fact:
    subnets_priv: "{{ subnets_priv + [ret_subnet.subnet.id] }}"
  when: item_subnet.route == 'rt_private'
  ignore_errors: "{{ ansible_check_mode }}"

- name: AWS | SUBNET | make Nat GW lists
  set_fact:
    subnets_natgw: "{{ subnets_natgw + [ret_subnet.subnet.id] }}"
  when: item_subnet.route == 'rt_natgw'
  ignore_errors: "{{ ansible_check_mode }}"
